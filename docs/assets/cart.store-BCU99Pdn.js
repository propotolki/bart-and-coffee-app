var x=Object.defineProperty,b=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var D=(t,e,a)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,S=(t,e)=>{for(var a in e||(e={}))q.call(e,a)&&D(t,a,e[a]);if(P)for(var a of P(e))w.call(e,a)&&D(t,a,e[a]);return t},h=(t,e)=>b(t,k(e));var y=(t,e,a)=>new Promise((p,l)=>{var i=s=>{try{r(a.next(s))}catch(n){l(n)}},v=s=>{try{r(a.throw(s))}catch(n){l(n)}},r=s=>s.done?p(s.value):Promise.resolve(s.value).then(i,v);r((a=a.apply(t,e)).next())});import{l as C,r as I,b as m}from"./index-BgJUy9vf.js";import{u as L}from"./loyalty.store-D_qsufFq.js";import{a as O}from"./index-BElEuAGz.js";const G=C("cart",()=>{const t=I([]),e=I(null),a=L(),p=m(()=>t.value.reduce((u,o)=>u+o.quantity,0)),l=m(()=>t.value.reduce((u,o)=>u+o.price*o.quantity,0)),i=m(()=>a.calculateDiscount(l.value)),v=m(()=>e.value?e.value.type==="percentage"?l.value*e.value.value/100:e.value.value:0),r=m(()=>l.value-i.value-v.value),s=(u,o=1)=>{const c=t.value.find(d=>d.id===u.id);c?c.quantity+=o:t.value.push(h(S({},u),{quantity:o}))},n=u=>{const o=t.value.findIndex(c=>c.id===u);o>-1&&t.value.splice(o,1)},g=(u,o)=>{const c=t.value.find(d=>d.id===u);c&&(o<=0?n(u):c.quantity=o)},f=()=>{t.value=[],e.value=null};return{items:t,appliedPromo:e,totalItems:p,subtotal:l,loyaltyDiscount:i,promoDiscount:v,total:r,addItem:s,removeItem:n,updateQuantity:g,clearCart:f,applyPromo:u=>y(void 0,null,function*(){const o=yield O.validate(u);return o.valid?(e.value={code:u,type:o.type,value:o.value},{success:!0}):{success:!1}}),removePromo:()=>{e.value=null},checkout:()=>y(void 0,null,function*(){try{const u={items:t.value,subtotal:l.value,loyaltyDiscount:i.value,promoDiscount:v.value,total:r.value,timestamp:new Date().toISOString()};return a.addPurchase(r.value),f(),{success:!0,order:u}}catch(u){return{success:!1,error:u.message}}})}});export{G as u};
