var b=(d,a,n)=>new Promise((l,v)=>{var m=i=>{try{o(n.next(i))}catch(g){v(g)}},u=i=>{try{o(n.throw(i))}catch(g){v(g)}},o=i=>i.done?l(i.value):Promise.resolve(i.value).then(m,u);o((n=n.apply(d,a)).next())});import{c as f,o as p,a as y,f as t,g as s,i as r,t as c,h as e,k as D,r as I,m as Q,d as L,F as C,e as P,j as A,n as B,b as $,u as E}from"./index-BgJUy9vf.js";import{u as S}from"./loyalty.store-D_qsufFq.js";import{B as j}from"./Button-MhB0ftXQ.js";import{T as _,G as h}from"./Group-DEGhva3t.js";import{C as R}from"./Cell-ByABXtIu.js";import{a as G,j as w,R as H,b as T,c as V,d as N,_ as k}from"./Typography-Byh9fUcv.js";import{g as M}from"./qr-generator-uwnfUZoT.js";import{C as z}from"./Card-ByvdZ7uz.js";import{D as F}from"./Div-CBN9xYF6.js";import"./VisuallyHidden-8Hixhu_K.js";import"./useExternRef-BpbbNXQC.js";import"./Removable-BevrVg9y.js";import"./Headline-BNzsiov9.js";const O=(d,a,n)=>Math.max(a,Math.min(d,n)),U={accent:"vkuiProgress--appearance-accent",positive:"vkuiProgress--appearance-positive",negative:"vkuiProgress--appearance-negative"};function X(d){return d?{height:d,borderRadius:d/2}:void 0}function J(d,a){const n=X(d);return n?N({},a,n):a}const q=0,x=100,K=d=>{var{value:a=0,appearance:n="accent",height:l,style:v}=d,m=G(d,["value","appearance","height","style"]);const u=O(a,q,x),o=`${u} / ${x}`,i=J(l,v);return w.jsx(H,T(N({"aria-valuenow":a,title:o,style:i},m),{role:"progressbar","aria-valuemin":q,"aria-valuemax":x,baseClassName:V("vkuiProgress",U[n]),children:w.jsx("div",{className:"vkuiProgress__in",style:{width:`${u}%`}})}))},W={class:"loyalty-progress"},Y={class:"level-info"},Z={key:0,class:"progress-section"},ee={key:1,class:"max-level"},te={class:"stats"},se={__name:"LoyaltyProgress",setup(d){const a=S();return(n,l)=>(p(),f("div",W,[y("div",Y,[t(e(_),{weight:"semibold"},{default:s(()=>[r(c(e(a).currentLevelInfo.name),1)]),_:1}),t(e(_),{class:"discount-info"},{default:s(()=>[r(" Скидка: "+c(e(a).currentLevelInfo.discount)+"% ",1)]),_:1})]),e(a).nextLevelInfo?(p(),f("div",Z,[t(e(_),{class:"progress-label"},{default:s(()=>[r(' Прогресс до уровня "'+c(e(a).nextLevelInfo.name)+'" ',1)]),_:1}),t(e(K),{value:e(a).progressToNextLevel,class:"progress-bar"},null,8,["value"]),t(e(_),{class:"progress-text"},{default:s(()=>[r(c(e(a).monthlySpending)+"₽ из "+c(e(a).nextLevelInfo.minSpending)+"₽ ",1)]),_:1})])):(p(),f("div",ee,[t(e(_),null,{default:s(()=>l[0]||(l[0]=[r("Вы достигли максимального уровня лояльности!",-1)])),_:1,__:[0]})])),y("div",te,[t(e(R),null,{main:s(()=>l[1]||(l[1]=[r("Всего баллов",-1)])),after:s(()=>[r(c(e(a).totalPoints),1)]),_:1}),t(e(R),null,{main:s(()=>l[2]||(l[2]=[r("Потрачено в этом месяце",-1)])),after:s(()=>[r(c(e(a).monthlySpending)+"₽",1)]),_:1})])]))}},ae=k(se,[["__scopeId","data-v-39d40908"]]),oe={class:"qr-generator"},re={class:"qr-container"},ne=["src"],le={key:1,class:"qr-placeholder"},ie={__name:"QRCodeGenerator",setup(d){const a=D(),n=S(),l=I(null),v=()=>b(this,null,function*(){try{const u={userId:a.user.id,loyaltyLevel:n.currentLevel.value,availableDiscount:n.currentLevelInfo.discount};l.value=yield M(u)}catch(u){console.error("Ошибка генерации QR-кода:",u)}}),m=()=>{v()};return Q(()=>{v()}),(u,o)=>(p(),f("div",oe,[y("div",re,[l.value?(p(),f("img",{key:0,src:l.value,alt:"QR-код",class:"qr-code"},null,8,ne)):(p(),f("div",le,[t(e(_),null,{default:s(()=>o[0]||(o[0]=[r("QR-код загружается...",-1)])),_:1,__:[0]})]))]),t(e(_),{class:"qr-info"},{default:s(()=>o[1]||(o[1]=[r(" Покажите этот QR-код сотруднику при покупке для получения скидки ",-1)])),_:1,__:[1]}),t(e(j),{size:"m",mode:"secondary",onClick:m},{default:s(()=>o[2]||(o[2]=[r(" Обновить QR-код ",-1)])),_:1,__:[2]})]))}},ue=k(ie,[["__scopeId","data-v-7f6b75e8"]]),ce={class:"purchase-history"},de={class:"purchase-header"},_e={class:"purchase-items"},pe={class:"purchase-footer"},me={class:"purchase-total"},fe={key:0,class:"no-purchases"},ve={__name:"PurchaseHistory",setup(d){const a=I([]);Q(()=>{v()});const n=m=>{const u=new Date(m);return u.toLocaleDateString()+" "+u.toLocaleTimeString().slice(0,5)},l=m=>m==="completed"?"Завершен":m==="pending"?"В обработке":"Неизвестно",v=()=>{a.value=[{id:1001,timestamp:new Date(Date.now()-864e5),items:[{id:2,name:"Капучино",quantity:2,price:180},{id:8,name:"Тирамису",quantity:1,price:250}],total:610,discount:30,status:"completed"},{id:1e3,timestamp:new Date(Date.now()-1728e5),items:[{id:3,name:"Латте",quantity:1,price:200},{id:11,name:"Круассан",quantity:2,price:120}],total:440,discount:10,status:"completed"}]};return(m,u)=>(p(),f("div",ce,[(p(!0),f(C,null,P(a.value,o=>(p(),f("div",{key:o.id,class:"purchase-item"},[t(e(z),{mode:"outline"},{default:s(()=>[y("div",de,[t(e(_),{weight:"semibold"},{default:s(()=>[r("Заказ #"+c(o.id),1)]),_:2},1024),t(e(_),{class:"purchase-date"},{default:s(()=>[r(c(n(o.timestamp)),1)]),_:2},1024)]),y("div",_e,[(p(!0),f(C,null,P(o.items,i=>(p(),f("div",{key:i.id,class:"purchase-item-row"},[t(e(_),null,{default:s(()=>[r(c(i.name)+" x"+c(i.quantity),1)]),_:2},1024),t(e(_),null,{default:s(()=>[r(c(i.price*i.quantity)+"₽",1)]),_:2},1024)]))),128))]),t(e(F)),y("div",pe,[y("div",me,[t(e(_),{weight:"bold"},{default:s(()=>[r("Итого: "+c(o.total)+"₽",1)]),_:2},1024),o.discount>0?(p(),A(e(_),{key:0,class:"purchase-discount"},{default:s(()=>[r(" Скидка: "+c(o.discount)+"₽ ",1)]),_:2},1024)):L("",!0)]),t(e(_),{class:B(["purchase-status",o.status])},{default:s(()=>[r(c(l(o.status)),1)]),_:2},1032,["class"])])]),_:2},1024)]))),128)),a.value.length===0?(p(),f("div",fe,[t(e(_),null,{default:s(()=>u[0]||(u[0]=[r("История покупок пуста",-1)])),_:1,__:[0]})])):L("",!0)]))}},ye=k(ve,[["__scopeId","data-v-07396c2c"]]),ge={class:"profile"},Qe={__name:"Profile",setup(d){const a=E(),n=D(),l=S(),v=$(()=>n.user),m=$(()=>{var o;return{type:"image",src:((o=v.value)==null?void 0:o.photo)||"/images/default-avatar.png"}}),u=()=>{n.logout(),a.push("/")};return(o,i)=>(p(),f("div",ge,[t(e(h),{header:"Профиль"},{default:s(()=>[t(e(R),{before:m.value,multiline:""},{main:s(()=>{var g;return[r(c((g=v.value)==null?void 0:g.name),1)]}),sub:s(()=>[r(c(e(l).currentLevelInfo.name),1)]),_:1},8,["before"])]),_:1}),t(e(h),{header:"Уровень лояльности"},{default:s(()=>[t(ae)]),_:1}),t(e(h),{header:"QR-код для покупок"},{default:s(()=>[t(ue)]),_:1}),t(e(h),{header:"История покупок"},{default:s(()=>[t(ye)]),_:1}),t(e(h),null,{default:s(()=>[t(e(j),{size:"l",mode:"secondary",onClick:u},{default:s(()=>i[0]||(i[0]=[r(" Выйти ",-1)])),_:1,__:[0]})]),_:1})]))}};export{Qe as default};
