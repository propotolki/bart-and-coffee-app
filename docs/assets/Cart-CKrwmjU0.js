var I=(n,s,e)=>new Promise((r,y)=>{var g=m=>{try{u(e.next(m))}catch(p){y(p)}},c=m=>{try{u(e.throw(m))}catch(p){y(p)}},u=m=>m.done?r(m.value):Promise.resolve(m.value).then(g,c);u((e=e.apply(n,s)).next())});import{i as f,o as l,w as o,a as $,b as a,u as t,e as i,t as d,r as w,c as C,g as P,d as x,F as z,h as D}from"./index-BM9-ZzJv.js";import{u as h}from"./cart.store-B_MddW1J.js";import{B as _}from"./Button-qiQ7ZsJW.js";import{T as v,G as b}from"./Group-CwB5ySvJ.js";import{P as V}from"./Placeholder-DoLLt2Ty.js";import{C as k}from"./Cell-BNt2Bp-4.js";import{_ as S}from"./_plugin-vue_export-helper-CR7FrT2r.js";import{S as B}from"./Search-CnRoLnWt.js";import{D as N}from"./Div-CeH7fYlb.js";import"./loyalty.store-gz-P3R1c.js";import"./index-BElEuAGz.js";import"./Headline-Dt9Khb9w.js";import"./Removable-Bc8LWK6o.js";import"./useGlobalEventListener-xhFFMBx8.js";import"./IconButton-CJDG5Ox1.js";import"./functions-CrPul0d0.js";const T={class:"cart-item"},Q=["src","alt"],F={class:"item-info"},G={class:"item-controls"},O={__name:"CartItem",props:{item:{type:Object,required:!0}},emits:["update-quantity","remove"],setup(n){return(s,e)=>(l(),f(t(k),null,{default:o(()=>[$("div",T,[$("img",{src:n.item.image,alt:n.item.name,class:"item-image"},null,8,Q),$("div",F,[a(t(v),{weight:"semibold"},{default:o(()=>[i(d(n.item.name),1)]),_:1}),a(t(v),{class:"item-description"},{default:o(()=>[i(d(n.item.description),1)]),_:1}),a(t(v),{class:"item-price"},{default:o(()=>[i(d(n.item.price)+"₽",1)]),_:1})]),$("div",G,[a(t(_),{size:"s",mode:"secondary",onClick:e[0]||(e[0]=r=>s.$emit("update-quantity",n.item.id,n.item.quantity-1))},{default:o(()=>e[3]||(e[3]=[i(" - ",-1)])),_:1,__:[3]}),a(t(v),{class:"quantity"},{default:o(()=>[i(d(n.item.quantity),1)]),_:1}),a(t(_),{size:"s",mode:"secondary",onClick:e[1]||(e[1]=r=>s.$emit("update-quantity",n.item.id,n.item.quantity+1))},{default:o(()=>e[4]||(e[4]=[i(" + ",-1)])),_:1,__:[4]}),a(t(_),{size:"s",mode:"destructive",onClick:e[2]||(e[2]=r=>s.$emit("remove",n.item.id))},{default:o(()=>e[5]||(e[5]=[i(" Удалить ",-1)])),_:1,__:[5]})])])]),_:1}))}},R=S(O,[["__scopeId","data-v-dff5eb4b"]]),U={class:"promo-code"},j={key:0,class:"promo-input"},E={key:1,class:"applied-promo"},L={__name:"PromoCode",setup(n){const s=h(),e=w(""),r=()=>{},y=()=>I(this,null,function*(){if(!e.value)return;const c=yield s.applyPromo(e.value);c!=null&&c.success&&(e.value="")}),g=()=>{s.removePromo()};return(c,u)=>(l(),C("div",U,[t(s).appliedPromo?(l(),C("div",E,[a(t(k),null,{main:o(()=>[i(" Промокод: "+d(t(s).appliedPromo.code),1)]),after:o(()=>[a(t(_),{size:"s",mode:"destructive",onClick:g},{default:o(()=>u[2]||(u[2]=[i(" Убрать ",-1)])),_:1,__:[2]})]),_:1})])):(l(),C("div",j,[a(t(B),{modelValue:e.value,"onUpdate:modelValue":u[0]||(u[0]=m=>e.value=m),placeholder:"Введите промокод...",onInput:r},null,8,["modelValue"]),a(t(_),{size:"m",mode:"secondary",onClick:y,disabled:!e.value},{default:o(()=>u[1]||(u[1]=[i(" Применить ",-1)])),_:1,__:[1]},8,["disabled"])]))]))}},M=S(L,[["__scopeId","data-v-31d51a83"]]),A={class:"cart-summary"},H={__name:"CartSummary",setup(n){const s=h();return(e,r)=>(l(),C("div",A,[a(t(k),null,{main:o(()=>r[0]||(r[0]=[i("Подытог",-1)])),after:o(()=>[i(d(t(s).subtotal)+"₽",1)]),_:1}),t(s).loyaltyDiscount>0?(l(),f(t(k),{key:0},{main:o(()=>r[1]||(r[1]=[i("Скидка по лояльности",-1)])),after:o(()=>[i("-"+d(t(s).loyaltyDiscount)+"₽",1)]),_:1})):P("",!0),t(s).promoDiscount>0?(l(),f(t(k),{key:1},{main:o(()=>r[2]||(r[2]=[i("Скидка по промокоду",-1)])),after:o(()=>[i("-"+d(t(s).promoDiscount)+"₽",1)]),_:1})):P("",!0),a(t(N)),a(t(k),null,{main:o(()=>[a(t(v),{weight:"bold"},{default:o(()=>r[3]||(r[3]=[i("Итого к оплате",-1)])),_:1,__:[3]})]),after:o(()=>[a(t(v),{weight:"bold",class:"total-price"},{default:o(()=>[i(d(t(s).total)+"₽ ",1)]),_:1})]),_:1})]))}},J=S(H,[["__scopeId","data-v-b869e33e"]]),K={class:"cart"},pt={__name:"Cart",setup(n){const s=x(),e=h(),r=w(!1),y=()=>{s.push("/menu")},g=(m,p)=>{e.updateQuantity(m,p)},c=m=>{e.removeItem(m)},u=()=>I(this,null,function*(){r.value=!0;try{(yield e.checkout()).success&&s.push("/profile")}catch(m){console.error("Ошибка оформления заказа:",m)}finally{r.value=!1}});return(m,p)=>(l(),C("div",K,[t(e).items.length===0?(l(),f(t(b),{key:0,header:"Корзина пуста"},{default:o(()=>[a(t(V),{header:"В корзине пока ничего нет",text:"Добавьте товары из меню"},{default:o(()=>[a(t(_),{size:"m",mode:"primary",onClick:y},{default:o(()=>p[0]||(p[0]=[i(" Перейти к меню ",-1)])),_:1,__:[0]})]),_:1})]),_:1})):(l(),f(t(b),{key:1,header:"Ваш заказ"},{default:o(()=>[(l(!0),C(z,null,D(t(e).items,q=>(l(),f(R,{key:q.id,item:q,onUpdateQuantity:g,onRemove:c},null,8,["item"]))),128))]),_:1})),t(e).items.length>0?(l(),f(t(b),{key:2,header:"Промокод"},{default:o(()=>[a(M)]),_:1})):P("",!0),t(e).items.length>0?(l(),f(t(b),{key:3,header:"Итого"},{default:o(()=>[a(J),a(t(_),{size:"l",mode:"primary",stretched:"",onClick:u,disabled:r.value},{default:o(()=>[i(d(r.value?"Оформление...":"Оформить заказ"),1)]),_:1},8,["disabled"])]),_:1})):P("",!0)]))}};export{pt as default};
