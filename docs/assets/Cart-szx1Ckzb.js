var I=(m,s,e)=>new Promise((r,y)=>{var g=n=>{try{u(e.next(n))}catch(p){y(p)}},c=n=>{try{u(e.throw(n))}catch(p){y(p)}},u=n=>n.done?r(n.value):Promise.resolve(n.value).then(g,c);u((e=e.apply(m,s)).next())});import{j as f,o as l,g as o,a as $,f as a,h as t,i,t as d,r as x,c as C,d as P,u as z,F as D,e as V}from"./index-BgJUy9vf.js";import{u as h}from"./cart.store-BCU99Pdn.js";import{B as _}from"./Button-MhB0ftXQ.js";import{T as v,G as b}from"./Group-DEGhva3t.js";import{P as w}from"./Placeholder-D1tDdZ4g.js";import{C as k}from"./Cell-ByABXtIu.js";import{_ as S}from"./Typography-Byh9fUcv.js";import{S as B}from"./Search-UlR6Wlka.js";import{D as N}from"./Div-CBN9xYF6.js";import"./loyalty.store-D_qsufFq.js";import"./index-BElEuAGz.js";import"./VisuallyHidden-8Hixhu_K.js";import"./Headline-BNzsiov9.js";import"./useExternRef-BpbbNXQC.js";import"./Removable-BevrVg9y.js";const T={class:"cart-item"},Q=["src","alt"],j={class:"item-info"},F={class:"item-controls"},G={__name:"CartItem",props:{item:{type:Object,required:!0}},emits:["update-quantity","remove"],setup(m){return(s,e)=>(l(),f(t(k),null,{default:o(()=>[$("div",T,[$("img",{src:m.item.image,alt:m.item.name,class:"item-image"},null,8,Q),$("div",j,[a(t(v),{weight:"semibold"},{default:o(()=>[i(d(m.item.name),1)]),_:1}),a(t(v),{class:"item-description"},{default:o(()=>[i(d(m.item.description),1)]),_:1}),a(t(v),{class:"item-price"},{default:o(()=>[i(d(m.item.price)+"₽",1)]),_:1})]),$("div",F,[a(t(_),{size:"s",mode:"secondary",onClick:e[0]||(e[0]=r=>s.$emit("update-quantity",m.item.id,m.item.quantity-1))},{default:o(()=>e[3]||(e[3]=[i(" - ",-1)])),_:1,__:[3]}),a(t(v),{class:"quantity"},{default:o(()=>[i(d(m.item.quantity),1)]),_:1}),a(t(_),{size:"s",mode:"secondary",onClick:e[1]||(e[1]=r=>s.$emit("update-quantity",m.item.id,m.item.quantity+1))},{default:o(()=>e[4]||(e[4]=[i(" + ",-1)])),_:1,__:[4]}),a(t(_),{size:"s",mode:"destructive",onClick:e[2]||(e[2]=r=>s.$emit("remove",m.item.id))},{default:o(()=>e[5]||(e[5]=[i(" Удалить ",-1)])),_:1,__:[5]})])])]),_:1}))}},O=S(G,[["__scopeId","data-v-dff5eb4b"]]),R={class:"promo-code"},U={key:0,class:"promo-input"},E={key:1,class:"applied-promo"},L={__name:"PromoCode",setup(m){const s=h(),e=x(""),r=()=>{},y=()=>I(this,null,function*(){if(!e.value)return;const c=yield s.applyPromo(e.value);c!=null&&c.success&&(e.value="")}),g=()=>{s.removePromo()};return(c,u)=>(l(),C("div",R,[t(s).appliedPromo?(l(),C("div",E,[a(t(k),null,{main:o(()=>[i(" Промокод: "+d(t(s).appliedPromo.code),1)]),after:o(()=>[a(t(_),{size:"s",mode:"destructive",onClick:g},{default:o(()=>u[2]||(u[2]=[i(" Убрать ",-1)])),_:1,__:[2]})]),_:1})])):(l(),C("div",U,[a(t(B),{modelValue:e.value,"onUpdate:modelValue":u[0]||(u[0]=n=>e.value=n),placeholder:"Введите промокод...",onInput:r},null,8,["modelValue"]),a(t(_),{size:"m",mode:"secondary",onClick:y,disabled:!e.value},{default:o(()=>u[1]||(u[1]=[i(" Применить ",-1)])),_:1,__:[1]},8,["disabled"])]))]))}},M=S(L,[["__scopeId","data-v-31d51a83"]]),A={class:"cart-summary"},H={__name:"CartSummary",setup(m){const s=h();return(e,r)=>(l(),C("div",A,[a(t(k),null,{main:o(()=>r[0]||(r[0]=[i("Подытог",-1)])),after:o(()=>[i(d(t(s).subtotal)+"₽",1)]),_:1}),t(s).loyaltyDiscount>0?(l(),f(t(k),{key:0},{main:o(()=>r[1]||(r[1]=[i("Скидка по лояльности",-1)])),after:o(()=>[i("-"+d(t(s).loyaltyDiscount)+"₽",1)]),_:1})):P("",!0),t(s).promoDiscount>0?(l(),f(t(k),{key:1},{main:o(()=>r[2]||(r[2]=[i("Скидка по промокоду",-1)])),after:o(()=>[i("-"+d(t(s).promoDiscount)+"₽",1)]),_:1})):P("",!0),a(t(N)),a(t(k),null,{main:o(()=>[a(t(v),{weight:"bold"},{default:o(()=>r[3]||(r[3]=[i("Итого к оплате",-1)])),_:1,__:[3]})]),after:o(()=>[a(t(v),{weight:"bold",class:"total-price"},{default:o(()=>[i(d(t(s).total)+"₽ ",1)]),_:1})]),_:1})]))}},J=S(H,[["__scopeId","data-v-b869e33e"]]),K={class:"cart"},ct={__name:"Cart",setup(m){const s=z(),e=h(),r=x(!1),y=()=>{s.push("/menu")},g=(n,p)=>{e.updateQuantity(n,p)},c=n=>{e.removeItem(n)},u=()=>I(this,null,function*(){r.value=!0;try{(yield e.checkout()).success&&s.push("/profile")}catch(n){console.error("Ошибка оформления заказа:",n)}finally{r.value=!1}});return(n,p)=>(l(),C("div",K,[t(e).items.length===0?(l(),f(t(b),{key:0,header:"Корзина пуста"},{default:o(()=>[a(t(w),{header:"В корзине пока ничего нет",text:"Добавьте товары из меню"},{default:o(()=>[a(t(_),{size:"m",mode:"primary",onClick:y},{default:o(()=>p[0]||(p[0]=[i(" Перейти к меню ",-1)])),_:1,__:[0]})]),_:1})]),_:1})):(l(),f(t(b),{key:1,header:"Ваш заказ"},{default:o(()=>[(l(!0),C(D,null,V(t(e).items,q=>(l(),f(O,{key:q.id,item:q,onUpdateQuantity:g,onRemove:c},null,8,["item"]))),128))]),_:1})),t(e).items.length>0?(l(),f(t(b),{key:2,header:"Промокод"},{default:o(()=>[a(M)]),_:1})):P("",!0),t(e).items.length>0?(l(),f(t(b),{key:3,header:"Итого"},{default:o(()=>[a(J),a(t(_),{size:"l",mode:"primary",stretched:"",onClick:u,disabled:r.value},{default:o(()=>[i(d(r.value?"Оформление...":"Оформить заказ"),1)]),_:1},8,["disabled"])]),_:1})):P("",!0)]))}};export{ct as default};
