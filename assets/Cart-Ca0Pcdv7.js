var I=(l,s,t)=>new Promise((r,y)=>{var g=n=>{try{u(t.next(n))}catch(f){y(f)}},c=n=>{try{u(t.throw(n))}catch(f){y(f)}},u=n=>n.done?r(n.value):Promise.resolve(n.value).then(g,c);u((t=t.apply(l,s)).next())});import{i as p,o as m,w as o,a as $,b as a,e,T as v,d as i,t as d,C as k,r as w,c as C,g as P,G as b,u as x,F as z,h as D}from"./index-QiXJX-Ca.js";import{u as h}from"./cart.store-CHDj1d7X.js";import{B as _}from"./Button-fRwF3mYj.js";import{P as V}from"./Placeholder-Dt38oayc.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as B}from"./Search-DNVYqQT1.js";import{D as N}from"./Div-qob8sKa2.js";import"./loyalty.store-CCmQ8-3d.js";import"./index-BElEuAGz.js";const T={class:"cart-item"},Q=["src","alt"],F={class:"item-info"},G={class:"item-controls"},O={__name:"CartItem",props:{item:{type:Object,required:!0}},emits:["update-quantity","remove"],setup(l){return(s,t)=>(m(),p(e(k),null,{default:o(()=>[$("div",T,[$("img",{src:l.item.image,alt:l.item.name,class:"item-image"},null,8,Q),$("div",F,[a(e(v),{weight:"semibold"},{default:o(()=>[i(d(l.item.name),1)]),_:1}),a(e(v),{class:"item-description"},{default:o(()=>[i(d(l.item.description),1)]),_:1}),a(e(v),{class:"item-price"},{default:o(()=>[i(d(l.item.price)+"₽",1)]),_:1})]),$("div",G,[a(e(_),{size:"s",mode:"secondary",onClick:t[0]||(t[0]=r=>s.$emit("update-quantity",l.item.id,l.item.quantity-1))},{default:o(()=>t[3]||(t[3]=[i(" - ",-1)])),_:1,__:[3]}),a(e(v),{class:"quantity"},{default:o(()=>[i(d(l.item.quantity),1)]),_:1}),a(e(_),{size:"s",mode:"secondary",onClick:t[1]||(t[1]=r=>s.$emit("update-quantity",l.item.id,l.item.quantity+1))},{default:o(()=>t[4]||(t[4]=[i(" + ",-1)])),_:1,__:[4]}),a(e(_),{size:"s",mode:"destructive",onClick:t[2]||(t[2]=r=>s.$emit("remove",l.item.id))},{default:o(()=>t[5]||(t[5]=[i(" Удалить ",-1)])),_:1,__:[5]})])])]),_:1}))}},R=S(O,[["__scopeId","data-v-9ef820bc"]]),U={class:"promo-code"},j={key:0,class:"promo-input"},E={key:1,class:"applied-promo"},L={__name:"PromoCode",setup(l){const s=h(),t=w(""),r=()=>{},y=()=>I(this,null,function*(){if(!t.value)return;const c=yield s.applyPromo(t.value);c!=null&&c.success&&(t.value="")}),g=()=>{s.removePromo()};return(c,u)=>(m(),C("div",U,[e(s).appliedPromo?(m(),C("div",E,[a(e(k),null,{main:o(()=>[i(" Промокод: "+d(e(s).appliedPromo.code),1)]),after:o(()=>[a(e(_),{size:"s",mode:"destructive",onClick:g},{default:o(()=>u[2]||(u[2]=[i(" Убрать ",-1)])),_:1,__:[2]})]),_:1})])):(m(),C("div",j,[a(e(B),{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=n=>t.value=n),placeholder:"Введите промокод...",onInput:r},null,8,["modelValue"]),a(e(_),{size:"m",mode:"secondary",onClick:y,disabled:!t.value},{default:o(()=>u[1]||(u[1]=[i(" Применить ",-1)])),_:1,__:[1]},8,["disabled"])]))]))}},M=S(L,[["__scopeId","data-v-31d51a83"]]),A={class:"cart-summary"},H={__name:"CartSummary",setup(l){const s=h();return(t,r)=>(m(),C("div",A,[a(e(k),null,{main:o(()=>r[0]||(r[0]=[i("Подытог",-1)])),after:o(()=>[i(d(e(s).subtotal)+"₽",1)]),_:1}),e(s).loyaltyDiscount>0?(m(),p(e(k),{key:0},{main:o(()=>r[1]||(r[1]=[i("Скидка по лояльности",-1)])),after:o(()=>[i("-"+d(e(s).loyaltyDiscount)+"₽",1)]),_:1})):P("",!0),e(s).promoDiscount>0?(m(),p(e(k),{key:1},{main:o(()=>r[2]||(r[2]=[i("Скидка по промокоду",-1)])),after:o(()=>[i("-"+d(e(s).promoDiscount)+"₽",1)]),_:1})):P("",!0),a(e(N)),a(e(k),null,{main:o(()=>[a(e(v),{weight:"bold"},{default:o(()=>r[3]||(r[3]=[i("Итого к оплате",-1)])),_:1,__:[3]})]),after:o(()=>[a(e(v),{weight:"bold",class:"total-price"},{default:o(()=>[i(d(e(s).total)+"₽ ",1)]),_:1})]),_:1})]))}},J=S(H,[["__scopeId","data-v-b869e33e"]]),K={class:"cart"},ie={__name:"Cart",setup(l){const s=x(),t=h(),r=w(!1),y=()=>{s.push("/menu")},g=(n,f)=>{t.updateQuantity(n,f)},c=n=>{t.removeItem(n)},u=()=>I(this,null,function*(){r.value=!0;try{(yield t.checkout()).success&&s.push("/profile")}catch(n){console.error("Ошибка оформления заказа:",n)}finally{r.value=!1}});return(n,f)=>(m(),C("div",K,[e(t).items.length===0?(m(),p(e(b),{key:0,header:"Корзина пуста"},{default:o(()=>[a(e(V),{header:"В корзине пока ничего нет",text:"Добавьте товары из меню"},{default:o(()=>[a(e(_),{size:"m",mode:"primary",onClick:y},{default:o(()=>f[0]||(f[0]=[i(" Перейти к меню ",-1)])),_:1,__:[0]})]),_:1})]),_:1})):(m(),p(e(b),{key:1,header:"Ваш заказ"},{default:o(()=>[(m(!0),C(z,null,D(e(t).items,q=>(m(),p(R,{key:q.id,item:q,onUpdateQuantity:g,onRemove:c},null,8,["item"]))),128))]),_:1})),e(t).items.length>0?(m(),p(e(b),{key:2,header:"Промокод"},{default:o(()=>[a(M)]),_:1})):P("",!0),e(t).items.length>0?(m(),p(e(b),{key:3,header:"Итого"},{default:o(()=>[a(J),a(e(_),{size:"l",mode:"primary",stretched:"",onClick:u,disabled:r.value},{default:o(()=>[i(d(r.value?"Оформление...":"Оформить заказ"),1)]),_:1},8,["disabled"])]),_:1})):P("",!0)]))}};export{ie as default};
