var L=(_,o,l)=>new Promise((n,v)=>{var m=i=>{try{a(l.next(i))}catch(g){v(g)}},u=i=>{try{a(l.throw(i))}catch(g){v(g)}},a=i=>i.done?n(i.value):Promise.resolve(i.value).then(m,u);a((l=l.apply(_,o)).next())});import{_ as A,l as b,R as B,m as E,n as G,p as H,q as D,c as f,o as p,a as y,b as t,w as s,d as r,t as c,e,T as d,C as R,j as I,r as Q,s as N,g as C,F as P,h as $,i as T,v as V,f as w,G as h,u as z}from"./index-Bao5TLqz.js";import{u as S}from"./loyalty.store-BUYQIvGK.js";import{B as j}from"./Button-BqemOLKD.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as M}from"./qr-generator-uwnfUZoT.js";import{C as F}from"./Card-Bp0vEcKe.js";import{D as O}from"./Div-DlVZe4XB.js";const U={accent:"vkuiProgress--appearance-accent",positive:"vkuiProgress--appearance-positive",negative:"vkuiProgress--appearance-negative"};function X(_){return _?{height:_,borderRadius:_/2}:void 0}function J(_,o){const l=X(_);return l?D({},o,l):o}const q=0,x=100,K=_=>{var{value:o=0,appearance:l="accent",height:n,style:v}=_,m=A(_,["value","appearance","height","style"]);const u=H(o,q,x),a=`${u} / ${x}`,i=J(n,v);return b.jsx(B,E(D({"aria-valuenow":o,title:a,style:i},m),{role:"progressbar","aria-valuemin":q,"aria-valuemax":x,baseClassName:G("vkuiProgress",U[l]),children:b.jsx("div",{className:"vkuiProgress__in",style:{width:`${u}%`}})}))},W={class:"loyalty-progress"},Y={class:"level-info"},Z={key:0,class:"progress-section"},ee={key:1,class:"max-level"},te={class:"stats"},se={__name:"LoyaltyProgress",setup(_){const o=S();return(l,n)=>(p(),f("div",W,[y("div",Y,[t(e(d),{weight:"semibold"},{default:s(()=>[r(c(e(o).currentLevelInfo.name),1)]),_:1}),t(e(d),{class:"discount-info"},{default:s(()=>[r(" Скидка: "+c(e(o).currentLevelInfo.discount)+"% ",1)]),_:1})]),e(o).nextLevelInfo?(p(),f("div",Z,[t(e(d),{class:"progress-label"},{default:s(()=>[r(' Прогресс до уровня "'+c(e(o).nextLevelInfo.name)+'" ',1)]),_:1}),t(e(K),{value:e(o).progressToNextLevel,class:"progress-bar"},null,8,["value"]),t(e(d),{class:"progress-text"},{default:s(()=>[r(c(e(o).monthlySpending)+"₽ из "+c(e(o).nextLevelInfo.minSpending)+"₽ ",1)]),_:1})])):(p(),f("div",ee,[t(e(d),null,{default:s(()=>n[0]||(n[0]=[r("Вы достигли максимального уровня лояльности!",-1)])),_:1,__:[0]})])),y("div",te,[t(e(R),null,{main:s(()=>n[1]||(n[1]=[r("Всего баллов",-1)])),after:s(()=>[r(c(e(o).totalPoints),1)]),_:1}),t(e(R),null,{main:s(()=>n[2]||(n[2]=[r("Потрачено в этом месяце",-1)])),after:s(()=>[r(c(e(o).monthlySpending)+"₽",1)]),_:1})])]))}},ae=k(se,[["__scopeId","data-v-39d40908"]]),oe={class:"qr-generator"},re={class:"qr-container"},ne=["src"],le={key:1,class:"qr-placeholder"},ie={__name:"QRCodeGenerator",setup(_){const o=I(),l=S(),n=Q(null),v=()=>L(this,null,function*(){try{const u={userId:o.user.id,loyaltyLevel:l.currentLevel.value,availableDiscount:l.currentLevelInfo.discount};n.value=yield M(u)}catch(u){console.error("Ошибка генерации QR-кода:",u)}}),m=()=>{v()};return N(()=>{v()}),(u,a)=>(p(),f("div",oe,[y("div",re,[n.value?(p(),f("img",{key:0,src:n.value,alt:"QR-код",class:"qr-code"},null,8,ne)):(p(),f("div",le,[t(e(d),null,{default:s(()=>a[0]||(a[0]=[r("QR-код загружается...",-1)])),_:1,__:[0]})]))]),t(e(d),{class:"qr-info"},{default:s(()=>a[1]||(a[1]=[r(" Покажите этот QR-код сотруднику при покупке для получения скидки ",-1)])),_:1,__:[1]}),t(e(j),{size:"m",mode:"secondary",onClick:m},{default:s(()=>a[2]||(a[2]=[r(" Обновить QR-код ",-1)])),_:1,__:[2]})]))}},ue=k(ie,[["__scopeId","data-v-7f6b75e8"]]),ce={class:"purchase-history"},de={class:"purchase-header"},_e={class:"purchase-items"},pe={class:"purchase-footer"},me={class:"purchase-total"},fe={key:0,class:"no-purchases"},ve={__name:"PurchaseHistory",setup(_){const o=Q([]);N(()=>{v()});const l=m=>{const u=new Date(m);return u.toLocaleDateString()+" "+u.toLocaleTimeString().slice(0,5)},n=m=>m==="completed"?"Завершен":m==="pending"?"В обработке":"Неизвестно",v=()=>{o.value=[{id:1001,timestamp:new Date(Date.now()-864e5),items:[{id:2,name:"Капучино",quantity:2,price:180},{id:8,name:"Тирамису",quantity:1,price:250}],total:610,discount:30,status:"completed"},{id:1e3,timestamp:new Date(Date.now()-1728e5),items:[{id:3,name:"Латте",quantity:1,price:200},{id:11,name:"Круассан",quantity:2,price:120}],total:440,discount:10,status:"completed"}]};return(m,u)=>(p(),f("div",ce,[(p(!0),f(P,null,$(o.value,a=>(p(),f("div",{key:a.id,class:"purchase-item"},[t(e(F),{mode:"outline"},{default:s(()=>[y("div",de,[t(e(d),{weight:"semibold"},{default:s(()=>[r("Заказ #"+c(a.id),1)]),_:2},1024),t(e(d),{class:"purchase-date"},{default:s(()=>[r(c(l(a.timestamp)),1)]),_:2},1024)]),y("div",_e,[(p(!0),f(P,null,$(a.items,i=>(p(),f("div",{key:i.id,class:"purchase-item-row"},[t(e(d),null,{default:s(()=>[r(c(i.name)+" x"+c(i.quantity),1)]),_:2},1024),t(e(d),null,{default:s(()=>[r(c(i.price*i.quantity)+"₽",1)]),_:2},1024)]))),128))]),t(e(O)),y("div",pe,[y("div",me,[t(e(d),{weight:"bold"},{default:s(()=>[r("Итого: "+c(a.total)+"₽",1)]),_:2},1024),a.discount>0?(p(),T(e(d),{key:0,class:"purchase-discount"},{default:s(()=>[r(" Скидка: "+c(a.discount)+"₽ ",1)]),_:2},1024)):C("",!0)]),t(e(d),{class:V(["purchase-status",a.status])},{default:s(()=>[r(c(n(a.status)),1)]),_:2},1032,["class"])])]),_:2},1024)]))),128)),o.value.length===0?(p(),f("div",fe,[t(e(d),null,{default:s(()=>u[0]||(u[0]=[r("История покупок пуста",-1)])),_:1,__:[0]})])):C("",!0)]))}},ye=k(ve,[["__scopeId","data-v-07396c2c"]]),ge={class:"profile"},Pe={__name:"Profile",setup(_){const o=z(),l=I(),n=S(),v=w(()=>l.user),m=w(()=>{var a;return{type:"image",src:((a=v.value)==null?void 0:a.photo)||"/images/default-avatar.png"}}),u=()=>{l.logout(),o.push("/")};return(a,i)=>(p(),f("div",ge,[t(e(h),{header:"Профиль"},{default:s(()=>[t(e(R),{before:m.value,multiline:""},{main:s(()=>{var g;return[r(c((g=v.value)==null?void 0:g.name),1)]}),sub:s(()=>[r(c(e(n).currentLevelInfo.name),1)]),_:1},8,["before"])]),_:1}),t(e(h),{header:"Уровень лояльности"},{default:s(()=>[t(ae)]),_:1}),t(e(h),{header:"QR-код для покупок"},{default:s(()=>[t(ue)]),_:1}),t(e(h),{header:"История покупок"},{default:s(()=>[t(ye)]),_:1}),t(e(h),null,{default:s(()=>[t(e(j),{size:"l",mode:"secondary",onClick:u},{default:s(()=>i[0]||(i[0]=[r(" Выйти ",-1)])),_:1,__:[0]})]),_:1})]))}};export{Pe as default};
